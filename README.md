项目介绍
===
本项目基于Python,出生于春运期间，针对MTR高铁购票网站，破解验证码，刷新余票，一旦出现余票立刻抢座并且邮件通知（尽管验证码成功率只有60%）（但是平均十次就能成功六次了呢！）（成功率低的原因是因为不想花钱去打码，只能自己手动生成和网站尽可能一样的验证码，因此训练库和实际验证码仍有一定差别）

实现方法
===
Python 操作网页 依赖模块  
        pip3 install selenium tensorflow==1.7.0 flask==1.0.2 requests==2.19.1 Pillow==4.3.0 matplotlib==2.1.0 easydict==1.8  
邮件发送方面，注意收件箱及发件箱均需开启 SMTP。  
***
对输入对应出发/到达站点/日期后，对网页进行截屏，并将验证码部分剪裁，进行分析解码。  
提交验证码后，监控是否出现买票的Button，若出现则点击进去完成占座，若未出现则继续破解验证码。  
注：若连续两次输入错验证码，点击提交验证码后网页并无反应，此时点击图片更换新的验证码继续破解，直到成功为止。  
***
验证码破解 参考项目 [基于卷积神经网络的验证码识别](https://github.com/nickliqian/cnn_captcha)  
该网站用的Kaptcha变种验证码，有生成类似验证码的JAVA包(可编译)，尽可能的编译成与网页图片相似的验证码，生成一万个数据作为模型进行训练。  
在自己生成的模型中，准确的已达到99%以上，但实际验证码仍存在不为我所知的不同的加噪方式，因此准确度只达到60%左右  

参数配置
===

buyticket.py文件
---

  本项目针对郑州东--香港西九龙，若需要改变出发/到达站点，相应XPATH也需改变。具体可看文件内注释  
  isElementExist中定义的Xpath也需改变，见下图标红区域获取Xpath  
  ![](https://github.com/yayachipi/I-will-have-ticket/blob/master/image/githun.png)
  不同屏幕不同分辨率可能会需要配置不同的数据  
  运行buyticket文件后获取screenshot.png文件，用WIN自带的画图软件打开，光标放置验证码图片的左上角及右下角得到图片起始坐标。  
  根据记录的坐标，改变如下参数：    
  rangle = (int(x1), int(y1), int(x2),int(y2))  
  
emailto_u.py文件
---
根据注释标注填写邮箱就可以了

使用方法
===
        1.打开 recognize_api.py 开启本地接口  
        2.打开buyticket.py文件运行  
        3.完成，等待邮件通知  

写在最后
===
完成的很匆忙，很多细节可能没有顾及到，需要使用而又有疑惑不知如何操作的请私信我，包教包会  
Python算是新手，逻辑思维还需加强，各位对此项目有更好的建议请不吝赐教
